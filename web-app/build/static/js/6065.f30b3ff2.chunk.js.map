{"version":3,"file":"static/js/6065.f30b3ff2.chunk.js","mappings":"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","sources":["screens/Console/Buckets/BucketDetails/AccessDetailsPanel.tsx"],"sourcesContent":["// This file is part of MinIO Console Server\n// Copyright (c) 2021 MinIO, Inc.\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\nimport React, { Fragment, useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { DataTable, SectionTitle, Tabs, HelpTip } from \"mds\";\nimport { api } from \"api\";\nimport { errorToHandler } from \"api/errors\";\nimport {\n  CONSOLE_UI_RESOURCE,\n  IAM_PAGES,\n  IAM_SCOPES,\n} from \"../../../../common/SecureComponent/permissions\";\nimport {\n  hasPermission,\n  SecureComponent,\n} from \"../../../../common/SecureComponent\";\nimport { encodeURLString } from \"../../../../common/utils\";\nimport { setErrorSnackMessage, setHelpName } from \"../../../../systemSlice\";\nimport { selBucketDetailsLoading } from \"./bucketDetailsSlice\";\nimport { useAppDispatch } from \"../../../../store\";\nimport { Policy } from \"../../../../api/consoleApi\";\n\nconst AccessDetails = () => {\n  const dispatch = useAppDispatch();\n  const navigate = useNavigate();\n  const params = useParams();\n\n  const loadingBucket = useSelector(selBucketDetailsLoading);\n\n  const [curTab, setCurTab] = useState<string>(\"simple-tab-0\");\n  const [loadingPolicies, setLoadingPolicies] = useState<boolean>(true);\n  const [bucketPolicy, setBucketPolicy] = useState<Policy[] | undefined>([]);\n  const [loadingUsers, setLoadingUsers] = useState<boolean>(true);\n  const [bucketUsers, setBucketUsers] = useState<string[]>([]);\n\n  const bucketName = params.bucketName || \"\";\n\n  const displayPoliciesList = hasPermission(bucketName, [\n    IAM_SCOPES.ADMIN_LIST_USER_POLICIES,\n  ]);\n\n  const displayUsersList = hasPermission(\n    bucketName,\n    [\n      IAM_SCOPES.ADMIN_GET_POLICY,\n      IAM_SCOPES.ADMIN_LIST_USERS,\n      IAM_SCOPES.ADMIN_LIST_GROUPS,\n    ],\n    true,\n  );\n\n  const viewUser = hasPermission(CONSOLE_UI_RESOURCE, [\n    IAM_SCOPES.ADMIN_GET_USER,\n  ]);\n  const viewPolicy = hasPermission(CONSOLE_UI_RESOURCE, [\n    IAM_SCOPES.ADMIN_GET_POLICY,\n    IAM_SCOPES.ADMIN_LIST_USERS,\n    IAM_SCOPES.ADMIN_LIST_GROUPS,\n  ]);\n\n  useEffect(() => {\n    if (loadingBucket) {\n      setLoadingUsers(true);\n      setLoadingPolicies(true);\n    }\n  }, [loadingBucket, setLoadingUsers, setLoadingPolicies]);\n\n  const PolicyActions = [\n    {\n      type: \"view\",\n      disableButtonFunction: () => !viewPolicy,\n      onClick: (policy: any) => {\n        navigate(`${IAM_PAGES.POLICIES}/${encodeURLString(policy.name)}`);\n      },\n    },\n  ];\n\n  const userTableActions = [\n    {\n      type: \"view\",\n      disableButtonFunction: () => !viewUser,\n      onClick: (user: any) => {\n        navigate(`${IAM_PAGES.USERS}/${encodeURLString(user)}`);\n      },\n    },\n  ];\n\n  useEffect(() => {\n    if (loadingUsers) {\n      if (displayUsersList) {\n        api.bucketUsers\n          .listUsersWithAccessToBucket(bucketName)\n          .then((res) => {\n            setBucketUsers(res.data);\n            setLoadingUsers(false);\n          })\n          .catch((err) => {\n            dispatch(setErrorSnackMessage(errorToHandler(err)));\n            setLoadingUsers(false);\n          });\n      } else {\n        setLoadingUsers(false);\n      }\n    }\n  }, [loadingUsers, dispatch, bucketName, displayUsersList]);\n\n  useEffect(() => {\n    dispatch(setHelpName(\"bucket_detail_access\"));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (loadingPolicies) {\n      if (displayPoliciesList) {\n        api.bucketPolicy\n          .listPoliciesWithBucket(bucketName)\n          .then((res) => {\n            setBucketPolicy(res.data.policies);\n            setLoadingPolicies(false);\n          })\n          .catch((err) => {\n            dispatch(setErrorSnackMessage(errorToHandler(err)));\n            setLoadingPolicies(false);\n          });\n      } else {\n        setLoadingPolicies(false);\n      }\n    }\n  }, [loadingPolicies, dispatch, bucketName, displayPoliciesList]);\n\n  return (\n    <Fragment>\n      <SectionTitle separator>\n        <HelpTip\n          content={\n            <Fragment>\n              Understand which{\" \"}\n              <a\n                target=\"blank\"\n                href=\"https://min.io/docs/minio/linux/administration/identity-access-management/policy-based-access-control.html#\"\n              >\n                Policies\n              </a>{\" \"}\n              and{\" \"}\n              <a\n                target=\"blank\"\n                href=\"https://min.io/docs/minio/linux/administration/identity-access-management/minio-user-management.html\"\n              >\n                Users\n              </a>{\" \"}\n              are authorized to access this Bucket.\n            </Fragment>\n          }\n          placement=\"right\"\n        >\n          Access Audit\n        </HelpTip>\n      </SectionTitle>\n      <Tabs\n        currentTabOrPath={curTab}\n        onTabClick={(newValue: string) => {\n          setCurTab(newValue);\n        }}\n        horizontal\n        options={[\n          {\n            tabConfig: { label: \"Policies\", id: \"simple-tab-0\" },\n            content: (\n              <SecureComponent\n                scopes={[IAM_SCOPES.ADMIN_LIST_USER_POLICIES]}\n                resource={bucketName}\n                errorProps={{ disabled: true }}\n              >\n                {bucketPolicy && (\n                  <DataTable\n                    noBackground={true}\n                    itemActions={PolicyActions}\n                    columns={[{ label: \"Name\", elementKey: \"name\" }]}\n                    isLoading={loadingPolicies}\n                    records={bucketPolicy}\n                    entityName=\"Policies\"\n                    idField=\"name\"\n                  />\n                )}\n              </SecureComponent>\n            ),\n          },\n          {\n            tabConfig: { label: \"Users\", id: \"simple-tab-1\" },\n            content: (\n              <SecureComponent\n                scopes={[\n                  IAM_SCOPES.ADMIN_GET_POLICY,\n                  IAM_SCOPES.ADMIN_LIST_USERS,\n                  IAM_SCOPES.ADMIN_LIST_GROUPS,\n                ]}\n                resource={bucketName}\n                matchAll\n                errorProps={{ disabled: true }}\n              >\n                <DataTable\n                  noBackground={true}\n                  itemActions={userTableActions}\n                  columns={[{ label: \"User\", elementKey: \"accessKey\" }]}\n                  isLoading={loadingUsers}\n                  records={bucketUsers}\n                  entityName=\"Users\"\n                  idField=\"accessKey\"\n                />\n              </SecureComponent>\n            ),\n          },\n        ]}\n      />\n    </Fragment>\n  );\n};\n\nexport default AccessDetails;\n"],"names":["AccessDetails","dispatch","useAppDispatch","navigate","useNavigate","params","useParams","loadingBucket","useSelector","selBucketDetailsLoading","curTab","setCurTab","useState","loadingPolicies","setLoadingPolicies","bucketPolicy","setBucketPolicy","loadingUsers","setLoadingUsers","bucketUsers","setBucketUsers","bucketName","displayPoliciesList","hasPermission","IAM_SCOPES","ADMIN_LIST_USER_POLICIES","displayUsersList","ADMIN_GET_POLICY","ADMIN_LIST_USERS","ADMIN_LIST_GROUPS","viewUser","CONSOLE_UI_RESOURCE","ADMIN_GET_USER","viewPolicy","useEffect","PolicyActions","type","disableButtonFunction","onClick","policy","concat","IAM_PAGES","POLICIES","encodeURLString","name","userTableActions","user","USERS","api","listUsersWithAccessToBucket","then","res","data","catch","err","setErrorSnackMessage","errorToHandler","setHelpName","listPoliciesWithBucket","policies","_jsxs","Fragment","children","_jsx","SectionTitle","separator","HelpTip","content","target","href","placement","Tabs","currentTabOrPath","onTabClick","newValue","horizontal","options","tabConfig","label","id","SecureComponent","scopes","resource","errorProps","disabled","DataTable","noBackground","itemActions","columns","elementKey","isLoading","records","entityName","idField","matchAll"],"sourceRoot":""}